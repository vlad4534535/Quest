<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Tactical Shooter: SHOP FIX</title>
    <style>
        body {
            margin: 0;
            overflow: hidden;
            background-color: #1a1a2e;
            font-family: 'Courier New', Courier, monospace;
            color: white;
            user-select: none;
            -webkit-user-select: none;
            touch-action: none;
        }
        canvas { display: block; }
        
        /* --- –°–¢–ê–ù–î–ê–†–¢–ù–ò–ô UI (–î–õ–Ø –ü–ö) --- */
        #game-ui {
            display: none;
            position: absolute;
            top: 10px; left: 10px;
            pointer-events: none;
            width: 100%;
            box-sizing: border-box;
            padding-right: 20px;
            z-index: 5;
        }
        #top-bar {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
        }
        .stat-box {
            background: rgba(0,0,0,0.6);
            padding: 5px 10px;
            border-radius: 5px;
            margin-bottom: 5px;
            font-size: 16px;
            border: 1px solid rgba(255,255,255,0.2);
        }
        #mission-text {
            font-size: 18px; font-weight: bold; color: #77DDFF;
            text-shadow: 1px 1px 0 #000;
        }
        #weapon-info { color: #aaa; }
        #grenade-counter { color: #FFA500; font-weight: bold; }
        #coin-counter { color: #FFFF00; font-weight: bold; }
        
        .bar-container {
            margin-top: 5px; width: 200px; height: 15px;
            background: #444; border: 2px solid #fff;
            position: relative;
        }
        #health-fill {
            width: 100%; height: 100%;
            background: #00FF00; transition: width 0.1s;
        }
        #xp-bar-container {
            margin-top: 5px; height: 10px; border-color: #0077FF;
        }
        #xp-fill {
            width: 0%; height: 100%;
            background: #0077FF; transition: width 0.2s;
        }
        #level-text {
            position: absolute; top: -20px; left: 0;
            font-size: 14px; color: #0077FF; font-weight: bold;
        }

        /* --- –ó–ê–ì–ê–õ–¨–ù–Ü –ï–õ–ï–ú–ï–ù–¢–ò –ú–ï–ù–Æ --- */
        .overlay {
            position: absolute; top: 0; left: 0;
            width: 100%; height: 100%;
            background: rgba(10, 20, 40, 0.95);
            display: flex; flex-direction: column;
            justify-content: center; align-items: center; 
            z-index: 20;
        }
        h1 { margin-bottom: 5px; font-size: 28px; color: #00AAFF; text-align: center; text-transform: uppercase; text-shadow: 0 0 10px white; }
        h2 { margin-bottom: 10px; font-size: 16px; color: #aaa; }
        h3 { margin: 5px 0; font-size: 18px; color: #aaa; text-align: center; }
        .menu-stats { color: #FFFF00; margin-bottom: 20px; font-size: 14px; border: 1px solid #555; padding: 10px; text-align: center; }
        
        .mission-grid {
            display: grid; grid-template-columns: 1fr 1fr; gap: 8px; margin-bottom: 10px;
            max-height: 60vh; overflow-y: auto;
        }

        .btn {
            background: #222; color: white;
            border: 2px solid #0077FF; padding: 10px;
            font-size: 12px; cursor: pointer; width: 160px;
            text-align: center; font-family: inherit; margin: 2px;
        }
        .btn:hover { background: #0077FF; color: black; }
        .boss-btn { border-color: #A020F0; color: #E0E0E0; }
        .hard-btn { border-color: #FF3333; color: #FFAAAA; }
        .special-btn { border-color: #00FFCC; color: #AAFFFF; }
        .shop-btn { border-color: #FFFF00; color: #FFFFAA; width: 340px; margin-top: 10px; font-size: 16px; font-weight: bold;}

        /* –ú–ê–ì–ê–ó–ò–ù (–ü–ö –≤–µ—Ä—Å—ñ—è) */
        #shop-screen { display: none; }
        .shop-container {
            display: flex; gap: 20px; width: 95%; max-width: 800px; justify-content: center; flex-wrap: wrap;
        }
        .shop-column {
            background: #223; padding: 15px; border: 2px solid #558; width: 280px;
        }
        .shop-item {
            display: flex; justify-content: space-between; align-items: center;
            margin-bottom: 10px; border-bottom: 1px solid #444; padding-bottom: 5px;
        }
        .buy-btn {
            background: #222; border: 1px solid #FFFF00; color: #FFFF00; padding: 5px 10px; cursor: pointer; font-size: 10px;
        }
        .buy-btn.owned { background: #004400; border-color: #00FF00; color: white; cursor: default; }
        .buy-btn.equipped { background: #00FF00; color: black; font-weight: bold; }
        .buy-btn:disabled { opacity: 0.5; cursor: not-allowed; border-color: #555; color: #555; }
        
        .preview-area {
            display: flex; flex-direction: column; align-items: center; margin-bottom: 15px;
        }

        /* –ü–†–û–ú–û–ö–û–î–ò */
        .promo-container {
            margin-top: 20px; padding: 10px; border-top: 2px dashed #555; width: 100%; text-align: center; box-sizing: border-box;
        }
        #promo-input {
            background: #111; border: 1px solid #0077FF; color: white; padding: 5px; width: 150px; font-family: inherit; text-transform: uppercase;
        }
        #promo-btn {
            background: #0077FF; color: white; border: none; padding: 5px 10px; cursor: pointer; font-family: inherit; margin-left: 5px;
        }

        /* CHEAT UI */
        #santa-cheat-btn {
            display: none;
            position: absolute; top: 10px; right: 10px;
            width: 50px; height: 50px;
            background: white; border-radius: 50%;
            text-align: center; line-height: 50px; font-size: 30px;
            cursor: pointer; z-index: 1000;
            box-shadow: 0 0 10px cyan;
            pointer-events: auto;
            user-select: none;
        }
        #cheat-menu {
            display: none;
            position: absolute; top: 70px; right: 10px;
            background: rgba(0,0,0,0.9); border: 2px solid white;
            padding: 15px; width: 200px; z-index: 999;
            pointer-events: auto;
            border-radius: 10px;
        }
        .cheat-option {
            margin-bottom: 15px; font-size: 16px; color: #00FF00; font-weight: bold;
            display: flex; justify-content: space-between; align-items: center;
        }

        /* --- –ú–û–ë–Ü–õ–¨–ù–ï –ö–ï–†–£–í–ê–ù–ù–Ø --- */
        #mobile-controls {
            display: none; position: absolute; top: 0; left: 0;
            width: 100%; height: 100%; pointer-events: none; z-index: 10;
        }
        .joystick-zone {
            position: absolute; bottom: 40px;
            width: 90px; height: 90px;
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%; pointer-events: auto;
        }
        #stick-left { left: 20px; }
        #stick-right { right: 20px; }
        .joystick-knob {
            position: absolute; top: 50%; left: 50%;
            width: 40px; height: 40px;
            background: rgba(0, 119, 255, 0.5);
            border-radius: 50%;
            transform: translate(-50%, -50%); pointer-events: none;
        }
        #stick-right .joystick-knob { background: rgba(255, 51, 51, 0.5); }
        
        #mobile-grenade-btn {
            position: absolute; bottom: 100px; right: 130px;
            width: 50px; height: 50px;
            background: rgba(255, 165, 0, 0.3); border: 2px solid #FFA500;
            border-radius: 50%; color: #FFA500; font-size: 20px;
            display: flex; justify-content: center; align-items: center;
            pointer-events: auto; cursor: pointer;
        }
        #mobile-grenade-btn:active { background: #FFA500; color: black; }
        
        #weapon-bar {
            position: absolute; bottom: 10px; left: 50%;
            transform: translateX(-50%); display: flex; gap: 5px; pointer-events: auto;
        }
        .wpn-btn {
            width: 35px; height: 35px; 
            background: #333; border: 1px solid #666;
            color: white; font-size: 9px; font-weight: bold;
            display: flex; justify-content: center; align-items: center;
            border-radius: 5px; font-family: inherit; cursor: pointer;
        }
        .wpn-btn.active { border-color: #0077FF; background: #004488; }
        .wpn-btn.locked { opacity: 0.3; border-color: #333; cursor: not-allowed; }
        
        #levelup-notify {
            position: absolute; top: 30%; left: 50%; transform: translate(-50%, -50%);
            font-size: 40px; color: #FFD700; font-weight: bold; text-shadow: 0 0 10px orange;
            pointer-events: none; opacity: 0; transition: opacity 0.5s; z-index: 100;
            text-align: center;
        }

        /* =============================================================== */
        /* === –°–ü–ï–¶–Ü–ê–õ–¨–ù–Ü –°–¢–ò–õ–Ü –î–õ–Ø –ú–û–ë–Ü–õ–¨–ù–û–ì–û –†–ï–ñ–ò–ú–£ (–ú–ê–ì–ê–ó–ò–ù) === */
        /* =============================================================== */
        
        /* –û—Å–Ω–æ–≤–Ω–∏–π UI –≥—Ä–∏ */
        body.mobile-mode .bar-container { width: 100px; height: 8px; border-width: 1px; }
        body.mobile-mode #xp-bar-container { height: 4px; }
        body.mobile-mode .stat-box { font-size: 10px; padding: 2px 4px; margin-bottom: 2px; }
        body.mobile-mode #mission-text { font-size: 12px; }
        body.mobile-mode #level-text { font-size: 10px; top: -14px; }
        body.mobile-mode #game-ui { padding-right: 5px; top: 5px; left: 5px; }
        
        /* –ú–ê–ì–ê–ó–ò–ù –í –ú–û–ë–Ü–õ–¨–ù–û–ú–£ –†–ï–ñ–ò–ú–Ü */
        body.mobile-mode .shop-container { flex-direction: column; align-items: center; padding-bottom: 60px; /* –ú—ñ—Å—Ü–µ –¥–ª—è –∫–Ω–æ–ø–∫–∏ –≤–∏—Ö–æ–¥—É */ }
        body.mobile-mode .shop-column { width: 95%; margin-bottom: 5px; padding: 5px; box-sizing: border-box; }
        body.mobile-mode h1 { font-size: 20px; }
        body.mobile-mode h3 { font-size: 14px; }
        body.mobile-mode .shop-item { font-size: 11px; padding-bottom: 2px; margin-bottom: 5px; }
        /* –°—É–ø–µ—Ä –∫–æ–º–ø–∞–∫—Ç–Ω—ñ –∫–Ω–æ–ø–∫–∏ –¥–ª—è –º–∞–≥–∞–∑–∏–Ω—É */
        body.mobile-mode .buy-btn { padding: 2px 5px; font-size: 10px; min-width: 30px; text-align: center; }
        
        /* –ö–æ–º–ø–∞–∫—Ç–Ω–µ –ø—Ä–µ–≤'—é */
        body.mobile-mode #previewCanvas { width: 100px; height: 100px; }
        body.mobile-mode .preview-area { margin-bottom: 5px; }

        /* –ó—Ä—É—á–Ω–∏–π –ø—Ä–æ–º–æ–∫–æ–¥ –¥–ª—è –ø–∞–ª—å—Ü—ñ–≤ */
        body.mobile-mode .promo-container { margin-top: 10px; padding: 5px; display: flex; justify-content: center; align-items: center; }
        body.mobile-mode #promo-input { width: 60%; font-size: 14px; padding: 8px; }
        body.mobile-mode #promo-btn { padding: 8px 15px; font-size: 14px; }

        /* –ö–Ω–æ–ø–∫–∏ –º–µ–Ω—é */
        body.mobile-mode .btn { padding: 5px; font-size: 10px; width: 140px; }
        body.mobile-mode .shop-btn { width: 90%; font-size: 12px; }
        body.mobile-mode #levelup-notify { font-size: 24px; }
        
        /* =============================================================== */
        
    </style>
</head>
<body>

    <div id="santa-cheat-btn">üéÖ</div>
    <div id="cheat-menu">
        <div class="cheat-option"><label>AIMBOT</label><input type="checkbox" id="chk-aim" onchange="toggleCheat('aim')"></div>
        <div class="cheat-option"><label>WH (ESP)</label><input type="checkbox" id="chk-wh" onchange="toggleCheat('wh')"></div>
        <div class="cheat-option"><label>AUTO LOOT</label><input type="checkbox" id="chk-autoloot" onchange="toggleCheat('autoloot')"></div>
        <div class="cheat-option"><label>WALLBANG</label><input type="checkbox" id="chk-wallbang" onchange="toggleCheat('wallbang')"></div>
    </div>

    <div id="platform-screen" class="overlay" style="z-index: 30;">
        <h1>Tactical Shooter<br>‚ùÑÔ∏è New Year ‚ùÑÔ∏è</h1>
        <h2>–û–±–µ—Ä—ñ—Ç—å –∫–µ—Ä—É–≤–∞–Ω–Ω—è</h2>
        <button class="btn" onclick="selectPlatform('PC')">üíª –ü–ö (–ö–ª–∞–≤—ñ–∞—Ç—É—Ä–∞)</button>
        <button class="btn" onclick="selectPlatform('MOBILE')">üì± –¢–µ–ª–µ—Ñ–æ–Ω (–°–µ–Ω—Å–æ—Ä)</button>
    </div>

    <div id="shop-screen" class="overlay" style="z-index: 25; display: none; overflow-y: auto;">
        <h1>–ú–ê–ì–ê–ó–ò–ù</h1>
        <div style="color: yellow; margin-bottom: 5px; font-size: 14px;">üí∞: <span id="shop-coins">0</span> | LVL: <span id="shop-level">1</span></div>
        
        <div class="shop-container">
            <div class="shop-column preview-area">
                <h3>–í–ò–ì–õ–Ø–î</h3>
                <canvas id="previewCanvas" width="150" height="150" style="border: 2px solid #555; background: #222; margin-bottom: 5px;"></canvas>
                <input type="color" id="colorPicker" value="#0077FF" onchange="updatePreview()">
            </div>

            <div class="shop-column">
                <h3>–ê–ö–°–ï–°–£–ê–†–ò</h3>
                <div id="accessories-list"></div>
            </div>

            <div class="shop-column">
                <h3>–ó–ë–†–û–Ø</h3>
                <div id="weapons-list"></div>
                
                <div class="promo-container">
                    <input type="text" id="promo-input" placeholder="–ö–û–î">
                    <button id="promo-btn" onclick="redeemCode()">OK</button>
                </div>
            </div>
        </div>

        <button class="btn" onclick="closeShop()" style="margin-top: 10px; width: 90%; position: fixed; bottom: 10px; z-index: 30;">–í–ò–ô–¢–ò –ó –ú–ê–ì–ê–ó–ò–ù–£</button>
    </div>

    <div id="menu-overlay" class="overlay" style="display: none;">
        <h1 id="menu-title">–ú–ï–ù–Æ –ú–Ü–°–Ü–ô</h1>
        <div class="menu-stats">
            LVL: <span id="menu-level">1</span> | XP: <span id="menu-xp">0</span> | üí∞: <span id="menu-coins">0</span>
        </div>
        
        <div id="menu-buttons" class="mission-grid">
            <button class="btn" onclick="startMission(1)">1: –û–∫–æ–ø (20—Å)</button>
            <button class="btn" onclick="startMission(2)">2: –ó–∞—á–∏—Å—Ç–∫–∞ (5)</button>
            <button class="btn boss-btn" onclick="startMission(3)">3: –ë–û–°</button>
            <button class="btn" onclick="startMission(4)">4: –û–†–î–ê (40—Å)</button>
            <button class="btn" onclick="startMission(5)">5: –ú'–Ø–°–û (50)</button>
            <button class="btn hard-btn" onclick="startMission(6)">6: –•–ê–†–î (60—Å)</button>
            <button class="btn grenade-mission-btn" onclick="startMission(7)">7: –ü–Ü–î–†–ò–í</button>
            <button class="btn hard-btn" onclick="startMission(8)">8: –ê–ü–û–ö–ê–õ–Ü–ü–°–ò–°</button>
            <button class="btn special-btn" onclick="startMission(9)">9: –ó–ê–•–í–ê–¢</button>
            <button class="btn special-btn" onclick="startMission(10)">10: –¢–ï–ú–†–Ø–í–ê</button>
            <button class="btn special-btn" onclick="startMission(11)">11: –°–ù–ê–ô–ü–ï–†</button>
        </div>
        <button class="btn shop-btn" onclick="openShop()">üõí –ú–ê–ì–ê–ó–ò–ù –Ü –ó–ë–†–û–Ø</button>
        <button id="end-game-btn" class="btn" onclick="showMainMenu()" style="display:none; background: #FF3333; margin-top: 20px;">–í –ì–û–õ–û–í–ù–ï –ú–ï–ù–Æ</button>
    </div>

    <div id="game-ui">
        <div id="top-bar">
            <div>
                <div id="mission-text">–¶—ñ–ª—å...</div>
                <div class="bar-container" id="health-bar"><div id="health-fill"></div></div>
                <div class="bar-container" id="xp-bar-container">
                    <div id="level-text">L1</div>
                    <div id="xp-fill"></div>
                </div>
                <div class="stat-box" id="weapon-info" style="margin-top: 5px;">–ó–±—Ä–æ—è</div>
            </div>
            <div style="text-align: right;">
                <div class="stat-box" id="stats">–ß–∞—Å: 0.0</div>
                <div class="stat-box" id="grenade-counter">üí£: 3</div>
                <div class="stat-box" id="coin-counter">üí∞: 0</div>
            </div>
        </div>
    </div>
    
    <div id="levelup-notify">–ù–û–í–ò–ô –†–Ü–í–ï–ù–¨!<br><span style="font-size:20px; color:white;">HP Full!</span></div>

    <div id="mobile-controls">
        <div id="stick-left" class="joystick-zone"><div class="joystick-knob" id="knob-left"></div></div>
        <div id="stick-right" class="joystick-zone"><div class="joystick-knob" id="knob-right"></div></div>
        <div id="mobile-grenade-btn" onclick="throwGrenadeMobile()">üí£</div>
        <div id="weapon-bar"></div>
    </div>

    <canvas id="gameCanvas"></canvas>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');

        function resize() {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
        }
        window.addEventListener('resize', resize);
        resize();

        let playerStats = {
            totalKills: 0, coins: 0, color: '#0077FF', xp: 0, level: 1, nextLevelXp: 100,
            unlockedWeapons: ['pistol', 'rifle', 'shotgun', 'sniper'],
            unlockedOutfits: ['none'], currentOutfit: 'none', redeemedCodes: [], cheatsUnlocked: false 
        };
        let activeCheats = { aim: false, wh: false, autoloot: false, wallbang: false };

        function toggleCheatMenu() {
            let menu = document.getElementById('cheat-menu');
            let btn = document.getElementById('santa-cheat-btn');
            if (menu.style.display !== 'block') {
                const rect = btn.getBoundingClientRect();
                menu.style.top = (rect.bottom + 5) + 'px';
                let leftPos = rect.left - (menu.offsetWidth - rect.width)/2;
                if(leftPos + 200 > window.innerWidth) leftPos = window.innerWidth - 210;
                menu.style.left = leftPos + 'px';
            }
            menu.style.display = menu.style.display === 'block' ? 'none' : 'block';
        }
        function toggleCheat(type) {
            if (type === 'aim') activeCheats.aim = document.getElementById('chk-aim').checked;
            if (type === 'wh') activeCheats.wh = document.getElementById('chk-wh').checked;
            if (type === 'autoloot') activeCheats.autoloot = document.getElementById('chk-autoloot').checked;
            if (type === 'wallbang') activeCheats.wallbang = document.getElementById('chk-wallbang').checked;
        }

        const santaBtn = document.getElementById('santa-cheat-btn');
        let dragObj = null; let dragOffsetX = 0; let dragOffsetY = 0; let isDraggingCheat = false;
        santaBtn.addEventListener('mousedown', (e) => { if(e.button !== 0) return; isDraggingCheat = false; dragObj = santaBtn; const rect = santaBtn.getBoundingClientRect(); dragOffsetX = e.clientX - rect.left; dragOffsetY = e.clientY - rect.top; });
        santaBtn.addEventListener('touchstart', (e) => { isDraggingCheat = false; dragObj = santaBtn; const rect = santaBtn.getBoundingClientRect(); dragOffsetX = e.touches[0].clientX - rect.left; dragOffsetY = e.touches[0].clientY - rect.top; e.preventDefault(); }, {passive: false});
        window.addEventListener('mousemove', (e) => { if (dragObj) { isDraggingCheat = true; let newLeft = e.clientX - dragOffsetX; let newTop = e.clientY - dragOffsetY; newLeft = Math.max(0, Math.min(window.innerWidth - dragObj.offsetWidth, newLeft)); newTop = Math.max(0, Math.min(window.innerHeight - dragObj.offsetHeight, newTop)); dragObj.style.left = newLeft + 'px'; dragObj.style.top = newTop + 'px'; dragObj.style.right = 'auto'; document.getElementById('cheat-menu').style.display = 'none'; } });
        window.addEventListener('touchmove', (e) => { if (dragObj) { isDraggingCheat = true; let newLeft = e.touches[0].clientX - dragOffsetX; let newTop = e.touches[0].clientY - dragOffsetY; newLeft = Math.max(0, Math.min(window.innerWidth - dragObj.offsetWidth, newLeft)); newTop = Math.max(0, Math.min(window.innerHeight - dragObj.offsetHeight, newTop)); dragObj.style.left = newLeft + 'px'; dragObj.style.top = newTop + 'px'; dragObj.style.right = 'auto'; document.getElementById('cheat-menu').style.display = 'none'; } });
        window.addEventListener('mouseup', () => { if (dragObj && !isDraggingCheat) toggleCheatMenu(); dragObj = null; });
        window.addEventListener('touchend', (e) => { if (dragObj && !isDraggingCheat) toggleCheatMenu(); dragObj = null; });

        function getNextLevelXp(lvl) { return Math.floor(100 * Math.pow(1.2, lvl - 1)); }
        function addPlayerXp(amount) { playerStats.xp += amount; if (playerStats.xp >= playerStats.nextLevelXp) levelUp(); updateUI(); }
        function levelUp() { playerStats.xp -= playerStats.nextLevelXp; playerStats.level++; playerStats.nextLevelXp = getNextLevelXp(playerStats.level); playerStats.coins += 50 * playerStats.level; if (player) player.hp = player.maxHp; showLevelUpEffect(); saveGame(); if (playerStats.xp >= playerStats.nextLevelXp) levelUp(); }
        function showLevelUpEffect() { const el = document.getElementById('levelup-notify'); el.style.opacity = 1; el.style.top = '40%'; setTimeout(() => { el.style.opacity = 0; el.style.top = '30%'; }, 2000); }
        function loadGame() {
            let saved = localStorage.getItem('tacticalShooterData_v2');
            if (saved) { let parsed = JSON.parse(saved); playerStats = { ...playerStats, ...parsed }; playerStats.nextLevelXp = getNextLevelXp(playerStats.level); if(!playerStats.redeemedCodes) playerStats.redeemedCodes = []; if(playerStats.cheatsUnlocked) document.getElementById('santa-cheat-btn').style.display = 'block'; }
            updateMenuStats();
        }
        function saveGame() { localStorage.setItem('tacticalShooterData_v2', JSON.stringify(playerStats)); updateMenuStats(); }
        function updateMenuStats() { document.getElementById('menu-coins').innerText = playerStats.coins; document.getElementById('menu-level').innerText = playerStats.level; document.getElementById('menu-xp').innerText = `${Math.floor(playerStats.xp)}/${playerStats.nextLevelXp}`; }

        const shopItems = {
            outfits: [{ id: 'none', name: '–ë–µ–∑ –µ–∫—ñ–ø—É', price: 0 }, { id: 'santa_hat', name: 'üéÖ –®–∞–ø–∫–∞', price: 0 }, { id: 'cap', name: 'üß¢ –ö–µ–ø–∫–∞', price: 150 }, { id: 'helmet', name: 'ü™ñ –ö–∞—Å–∫–∞', price: 300 }, { id: 'vest', name: 'üõ°Ô∏è –ñ–∏–ª–µ—Ç', price: 500 }],
            weapons: [{ id: 'minigun', name: '–ö–£–õ–ï–ú–ï–¢ (LVL 5)', price: 1000, levelReq: 5 }]
        };
        function redeemCode() {
            const input = document.getElementById('promo-input'); const code = input.value.trim().toUpperCase(); 
            const secretCode = "FHJWIDFNN2137217^$&*@JFUHIWHAAHSDN2273871287873201JDFJHWOMF%(#&$(*@&";
            if (playerStats.redeemedCodes.includes(code)) { alert("–í–∂–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–æ!"); return; }
            let success = false; let msg = "";
            if (code === secretCode) { playerStats.cheatsUnlocked = true; document.getElementById('santa-cheat-btn').style.display = 'block'; msg = "–•–û-–•–û-–•–û!"; success = true; }
            switch(code) {
                case 'XST46GYS73': playerStats.coins += 500; msg = "+500$"; success = true; break;
                case 'EYDHJ36KL4': playerStats.coins += 1000; msg = "+1000$"; success = true; break;
                case 'FGWLKCHS56': if (playerStats.level < 5) { playerStats.level = 5; playerStats.nextLevelXp = getNextLevelXp(5); playerStats.xp = 0; msg = "Level 5!"; } else msg = "–í–∂–µ 5+ —Ä—ñ–≤–µ–Ω—å."; success = true; break;
                case 'NEWYEAR2026': if (!playerStats.unlockedWeapons.includes('snowball')) { playerStats.unlockedWeapons.push('snowball'); msg = "–°–ù–Ü–ì–û–ú–ï–¢!"; success = true; } break;
                case 'DAVX5H8KD': playerStats.coins += 1000; if (playerStats.level < 5) { playerStats.level = 5; playerStats.nextLevelXp = getNextLevelXp(5); playerStats.xp = 0; } if (!playerStats.unlockedWeapons.includes('minigun')) playerStats.unlockedWeapons.push('minigun'); msg = "–ö–£–õ–ï–ú–ï–¢ + 1000$"; success = true; break;
                default: if(!success && code !== secretCode) alert("–ù–µ–≤—ñ—Ä–Ω–∏–π –∫–æ–¥!");
            }
            if (success) { playerStats.redeemedCodes.push(code); saveGame(); updateMenuStats(); document.getElementById('shop-coins').innerText = playerStats.coins; document.getElementById('shop-level').innerText = playerStats.level; renderShopItems(); alert(msg); input.value = ""; }
        }

        // --- –û–ù–û–í–õ–ï–ù–ê –§–£–ù–ö–¶–Ü–Ø –í–Ü–î–û–ë–†–ê–ñ–ï–ù–ù–Ø –ú–ê–ì–ê–ó–ò–ù–£ (–°–£–ü–ï–† –ö–û–ú–ü–ê–ö–¢–ù–ê) ---
        const pCtx = document.getElementById('previewCanvas').getContext('2d');
        function openShop() { document.getElementById('menu-overlay').style.display='none'; document.getElementById('shop-screen').style.display='flex'; document.getElementById('shop-coins').innerText=playerStats.coins; document.getElementById('shop-level').innerText=playerStats.level; renderShopItems(); updatePreview(); }
        function closeShop() { saveGame(); document.getElementById('shop-screen').style.display='none'; document.getElementById('menu-overlay').style.display='flex'; }
        function renderShopItems() {
            const al = document.getElementById('accessories-list'); al.innerHTML='';
            shopItems.outfits.forEach(i => {
                let div=document.createElement('div'); div.className='shop-item';
                let owned=playerStats.unlockedOutfits.includes(i.id), equipped=playerStats.currentOutfit===i.id;
                // –ö–æ–º–ø–∞–∫—Ç–Ω–∏–π —Ç–µ–∫—Å—Ç –∫–Ω–æ–ø–æ–∫
                let btnText = owned ? (equipped ? 'V' : '–í–∑—è—Ç–∏') : (i.price === 0 ? '0$' : i.price+'$');
                div.innerHTML=`<span>${i.name}</span><button class="buy-btn ${equipped?'equipped':(owned?'owned':'')}" onclick="handleShopAction('outfit','${i.id}',${i.price})">${btnText}</button>`;
                al.appendChild(div);
            });
            const wl = document.getElementById('weapons-list'); wl.innerHTML='';
            shopItems.weapons.forEach(i => {
                let div=document.createElement('div'); div.className='shop-item';
                let owned=playerStats.unlockedWeapons.includes(i.id), locked=i.levelReq && playerStats.level < i.levelReq;
                // –ö–æ–º–ø–∞–∫—Ç–Ω–∏–π —Ç–µ–∫—Å—Ç –∫–Ω–æ–ø–æ–∫
                let btnText = owned ? 'V' : (locked ? 'L'+i.levelReq : i.price+'$');
                div.innerHTML=`<span>${i.name}</span><button class="buy-btn ${owned?'owned':''}" onclick="handleShopAction('weapon','${i.id}',${i.price})" ${owned||locked?'disabled':''}>${btnText}</button>`;
                wl.appendChild(div);
            });
        }
        function handleShopAction(type, id, price) { if(type==='outfit') { if(playerStats.unlockedOutfits.includes(id)) playerStats.currentOutfit=id; else if(playerStats.coins>=price) { playerStats.coins-=price; playerStats.unlockedOutfits.push(id); playerStats.currentOutfit=id; } } else if(type==='weapon' && !playerStats.unlockedWeapons.includes(id)) { if(playerStats.coins>=price) { playerStats.coins-=price; playerStats.unlockedWeapons.push(id); } } updatePreview(); renderShopItems(); document.getElementById('shop-coins').innerText=playerStats.coins; }
        function updatePreview() { let c=document.getElementById('colorPicker').value; playerStats.color=c; pCtx.clearRect(0,0,150,150); pCtx.save(); pCtx.translate(75,75); pCtx.scale(2.5,2.5); pCtx.beginPath(); pCtx.arc(0,0,15,0,Math.PI*2); pCtx.fillStyle=c; pCtx.fill(); pCtx.strokeStyle='#000'; pCtx.lineWidth=1; pCtx.stroke(); if (playerStats.currentOutfit === 'santa_hat') { pCtx.fillStyle='#D40000'; pCtx.beginPath(); pCtx.moveTo(-15,-5); pCtx.lineTo(15,-5); pCtx.lineTo(0,-28); pCtx.fill(); pCtx.fillStyle='#FFF'; pCtx.fillRect(-16,-5,32,6); pCtx.beginPath(); pCtx.arc(0,-28,5,0,Math.PI*2); pCtx.fill(); } else if (playerStats.currentOutfit === 'helmet') { pCtx.fillStyle='#334400'; pCtx.beginPath(); pCtx.arc(0,0,16,Math.PI,0); pCtx.fill(); pCtx.fillStyle='#223300'; pCtx.fillRect(-15,-5,30,5); } else if (playerStats.currentOutfit === 'vest') { pCtx.fillStyle='#2E3B22'; pCtx.fillRect(-14,-14,28,28); pCtx.fillStyle='#4A5D3A'; pCtx.fillRect(-10,2,8,10); pCtx.fillRect(2,2,8,10); } else if (playerStats.currentOutfit === 'cap') { pCtx.fillStyle='#C2B280'; pCtx.beginPath(); pCtx.arc(0,0,15,Math.PI*0.8,Math.PI*3.2); pCtx.fill(); pCtx.fillStyle='#A09165'; pCtx.fillRect(13,-13,14,26); } pCtx.fillStyle='#000'; pCtx.fillRect(10,-3,15,6); pCtx.restore(); }

        // --- PLATFORM SELECTION ---
        function selectPlatform(mode) {
            controlMode = mode;
            document.getElementById('platform-screen').style.display = 'none';
            loadGame(); showMainMenu(); setupMobileWeapons();
            
            if(mode === 'MOBILE') {
                // –ê–ö–¢–ò–í–£–Ñ–ú–û –ú–û–ë–Ü–õ–¨–ù–ò–ô –†–ï–ñ–ò–ú (–ó–ú–Ü–ù–Æ–Ñ–ú–û CSS)
                document.body.classList.add('mobile-mode');
                document.getElementById('mobile-controls').style.display='block';
                document.getElementById('weapon-info').style.display='none';
            } else {
                // –í–ò–ú–ò–ö–ê–Ñ–ú–û –ú–û–ë–Ü–õ–¨–ù–ò–ô –†–ï–ñ–ò–ú (–ü–û–í–ï–†–¢–ê–Ñ–ú–û –°–¢–ê–ù–î–ê–†–¢)
                document.body.classList.remove('mobile-mode');
                document.getElementById('mobile-controls').style.display='none';
                document.getElementById('weapon-info').style.display='block';
            }
            // –ü–µ—Ä–µ–º–∞–ª—å–æ–≤—É—î–º–æ –º–∞–≥–∞–∑–∏–Ω –∑ –Ω–æ–≤–∏–º–∏ —Å—Ç–∏–ª—è–º–∏
            if(document.getElementById('shop-screen').style.display === 'flex') {
                renderShopItems();
            }
        }

        const PLAYER_SPEED = 4.5; const BULLET_SPEED = 14; const ENEMY_SPEED = 1.5; 
        let controlMode = 'PC'; let gameState = 'PLATFORM_SELECT'; let currentMissionId = 0;
        let gameTime = 0; let enemiesKilled = 0; let grenadesKilled = 0; let bossSpawned = false;
        let zoneTimer = 0; let captureZone = { x: 0, y: 0, radius: 100 }; let screenShake = 0;
        let obstacles = []; let bullets = []; let enemies = []; let particles = []; let drops = []; let thrownGrenades = []; let decorations = []; let snowflakes = []; let player;
        let keys = {}; let mouse = { x: 0, y: 0, down: false };
        let joystickLeft = { x: 0, y: 0, active: false, id: null }; let joystickRight = { x: 0, y: 0, active: false, id: null }; let lastAimAngle = 0;
        for(let i=0; i<60; i++) snowflakes.push({ x: Math.random()*window.innerWidth, y: Math.random()*window.innerHeight, r: Math.random()*2+0.5, s: Math.random()*1+0.2 });

        class DropItem { constructor(x, y, type) { this.x = x; this.y = y; this.type = type; this.size = 20; this.bobOffset = Math.random()*Math.PI*2; } draw() { let bob = Math.sin(gameTime * 5 + this.bobOffset) * 3; let Y = this.y + bob; if (this.type === 'medkit') { ctx.fillStyle = '#00CC00'; ctx.fillRect(this.x-10, Y-10, 20, 20); ctx.fillStyle = '#FFF'; ctx.fillRect(this.x-3, Y-8, 6, 16); ctx.fillRect(this.x-8, Y-3, 16, 6); } else if (this.type === 'grenade') { ctx.fillStyle = '#FFA500'; ctx.fillRect(this.x-10, Y-10, 20, 20); ctx.fillStyle='#000'; ctx.font="16px Arial"; ctx.fillText("üí£", this.x-9, Y+6); } else if (this.type === 'coin') { ctx.fillStyle='#FFFF00'; ctx.beginPath(); ctx.arc(this.x, Y, 10, 0, Math.PI*2); ctx.fill(); ctx.strokeStyle='#DAA520'; ctx.lineWidth=2; ctx.stroke(); ctx.fillStyle='#000'; ctx.font="bold 14px Arial"; ctx.fillText("$", this.x-4, Y+5); } } }
        class GrenadeObj { constructor(x, y, tx, ty) { this.x = x; this.y = y; this.timer = 60; this.dead = false; const angle = Math.atan2(ty - y, tx - x); const dist = Math.hypot(tx - x, ty - y); const speed = Math.min(dist / 20, 10); this.vx = Math.cos(angle) * speed; this.vy = Math.sin(angle) * speed; this.flyTime = Math.floor(dist / speed); } update() { if (this.flyTime > 0) { this.x += this.vx; this.y += this.vy; this.flyTime--; } this.timer--; if (this.timer <= 0) { this.explode(); this.dead = true; } } explode() { createExplosion(this.x, this.y); screenShake = 15; enemies.forEach(en => { if (Math.hypot(en.x - this.x, en.y - this.y) < 120) { en.takeDamage(150); if (en.hp <= 0) grenadesKilled++; } }); } draw() { ctx.beginPath(); ctx.arc(this.x, this.y, 6, 0, Math.PI*2); ctx.fillStyle = Math.floor(this.timer/5)%2===0 ? 'red' : 'yellow'; ctx.fill(); ctx.strokeStyle='#000'; ctx.stroke(); } }
        class Rect { constructor(x, y, size) { this.x = x; this.y = y; this.size = size; } draw() { ctx.fillStyle = '#556'; ctx.fillRect(this.x, this.y, this.size, this.size); ctx.fillStyle = '#EEF'; ctx.beginPath(); ctx.moveTo(this.x-2, this.y); ctx.lineTo(this.x+this.size+2, this.y); ctx.lineTo(this.x+this.size+2, this.y+15); for(let i=0; i<this.size; i+=10) ctx.arc(this.x+this.size-i, this.y+15, 5, 0, Math.PI); ctx.lineTo(this.x-2, this.y+15); ctx.fill(); ctx.strokeStyle='#223'; ctx.lineWidth=2; ctx.strokeRect(this.x, this.y, this.size, this.size); } }
        class Entity { constructor(x, y, radius, color, hp) { this.x=x; this.y=y; this.radius=radius; this.color=color; this.hp=hp; this.maxHp=hp; this.dead=false; this.cooldown=0; } drawBase() { ctx.beginPath(); ctx.arc(this.x, this.y, this.radius, 0, Math.PI*2); ctx.fillStyle=this.color; ctx.fill(); ctx.strokeStyle='#000'; ctx.lineWidth=2; ctx.stroke(); } drawHealthBar() { if (this.hp < this.maxHp || this instanceof Player) { ctx.save(); ctx.fillStyle = '#FFFFFF'; ctx.font = "bold 12px Courier New"; ctx.textAlign = "center"; ctx.shadowColor = "black"; ctx.shadowBlur = 4; ctx.fillText(Math.ceil(this.hp), this.x, this.y - this.radius - 15); ctx.restore(); } if (this.hp < this.maxHp) { let w = this.radius * 2; ctx.fillStyle='red'; ctx.fillRect(this.x-w/2, this.y-this.radius-10, w, 4); ctx.fillStyle='#00FF00'; ctx.fillRect(this.x-w/2, this.y-this.radius-10, w*(this.hp/this.maxHp), 4); } } move(dx, dy) { if (!this.checkWallCollision(this.x+dx, this.y)) this.x+=dx; if (!this.checkWallCollision(this.x, this.y+dy)) this.y+=dy; this.x=Math.max(this.radius, Math.min(canvas.width-this.radius, this.x)); this.y=Math.max(this.radius, Math.min(canvas.height-this.radius, this.y)); } checkWallCollision(x, y) { for (let obs of obstacles) { let cx=Math.max(obs.x, Math.min(x, obs.x+obs.size)); let cy=Math.max(obs.y, Math.min(y, obs.y+obs.size)); if ((x-cx)**2 + (y-cy)**2 < this.radius**2) return true; } return false; } }
        class Player extends Entity { constructor(x, y) { super(x, y, 15, playerStats.color, 100); this.weapon='pistol'; this.grenades=3; this.grenadeCooldown=0; this.angle=0; this.muzzleTimer=0; } draw() { ctx.save(); ctx.translate(this.x, this.y); ctx.rotate(this.angle); ctx.beginPath(); ctx.arc(0, 0, this.radius, 0, Math.PI*2); ctx.fillStyle=playerStats.color; ctx.fill(); ctx.strokeStyle='#000'; ctx.lineWidth=2; ctx.stroke(); if (playerStats.currentOutfit === 'santa_hat') { ctx.fillStyle='#D40000'; ctx.beginPath(); ctx.moveTo(-15,-5); ctx.lineTo(15,-5); ctx.lineTo(0,-28); ctx.fill(); ctx.fillStyle='#FFF'; ctx.fillRect(-16,-5,32,6); ctx.beginPath(); ctx.arc(0,-28,5,0,Math.PI*2); ctx.fill(); } else if (playerStats.currentOutfit === 'helmet') { ctx.fillStyle='#334400'; ctx.beginPath(); ctx.arc(0,0,16,Math.PI,0); ctx.fill(); ctx.fillStyle='#223300'; ctx.fillRect(-15,-5,30,5); } else if (playerStats.currentOutfit === 'vest') { ctx.fillStyle='#2E3B22'; ctx.fillRect(-14,-14,28,28); ctx.fillStyle='#4A5D3A'; ctx.fillRect(-10,2,8,10); ctx.fillRect(2,2,8,10); } else if (playerStats.currentOutfit === 'cap') { ctx.fillStyle='#C2B280'; ctx.beginPath(); ctx.arc(0,0,15,Math.PI*0.8,Math.PI*3.2); ctx.fill(); ctx.fillStyle='#A09165'; ctx.fillRect(13,-13,14,26); } if (this.weapon === 'snowball') { ctx.fillStyle='#00FFFF'; ctx.fillRect(10,-5,20,10); ctx.fillStyle='#FFF'; ctx.fillRect(12,-7,10,14); ctx.beginPath(); ctx.arc(10,0,5,0,Math.PI*2); ctx.fillStyle='#88FFFF'; ctx.fill(); } else { ctx.fillStyle='#000'; ctx.fillRect(10,-3,15,6); } if (this.muzzleTimer > 0) { ctx.beginPath(); ctx.arc(this.weapon==='snowball'?35:28, 0, 8+Math.random()*5, 0, Math.PI*2); ctx.fillStyle=this.weapon==='snowball'?`rgba(200,255,255,${this.muzzleTimer/3})`:`rgba(255,255,0,${this.muzzleTimer/3})`; ctx.fill(); this.muzzleTimer--; } ctx.restore(); } update() { if (this.cooldown > 0) this.cooldown--; if (this.grenadeCooldown > 0) this.grenadeCooldown--; let dx=0, dy=0; if (activeCheats.aim && enemies.length > 0) { let closest=null, minDist=Infinity; enemies.forEach(e=>{ let d=Math.hypot(e.x-this.x, e.y-this.y); if(d<minDist){minDist=d; closest=e;} }); if(closest) { this.angle=Math.atan2(closest.y-this.y, closest.x-this.x); lastAimAngle=this.angle; } } if (activeCheats.autoloot && drops.length > 0) { this.x=drops[0].x; this.y=drops[0].y; } if (controlMode === 'PC') { if (keys['Digit1']) this.trySetWeapon('pistol'); if (keys['Digit2']) this.trySetWeapon('rifle'); if (keys['Digit3']) this.trySetWeapon('shotgun'); if (keys['Digit4']) this.trySetWeapon('sniper'); if (keys['Digit5']) this.trySetWeapon('minigun'); if (keys['Digit6']) this.trySetWeapon('snowball'); if (keys['Space']) this.throwGrenade(mouse.x, mouse.y); if (keys['KeyW'] || keys['ArrowUp']) dy = -PLAYER_SPEED; if (keys['KeyS'] || keys['ArrowDown']) dy = PLAYER_SPEED; if (keys['KeyA'] || keys['ArrowLeft']) dx = -PLAYER_SPEED; if (keys['KeyD'] || keys['ArrowRight']) dx = PLAYER_SPEED; if (dx && dy) { dx *= 0.707; dy *= 0.707; } if (!activeCheats.aim) { this.angle = Math.atan2(mouse.y-this.y, mouse.x-this.x); lastAimAngle=this.angle; } if (mouse.down) this.shootInput(this.angle); } else { if (joystickLeft.active) { dx = joystickLeft.x * PLAYER_SPEED; dy = joystickLeft.y * PLAYER_SPEED; } if (joystickRight.active) { if (!activeCheats.aim) { this.angle = Math.atan2(joystickRight.y, joystickRight.x); lastAimAngle=this.angle; } this.shootInput(this.angle); } else if ((dx !== 0 || dy !== 0) && !activeCheats.aim) { this.angle = Math.atan2(dy, dx); } } this.move(dx, dy); } trySetWeapon(wpn) { if (wpn === 'minigun' && playerStats.level < 5) return; if (playerStats.unlockedWeapons.includes(wpn)) { this.weapon = wpn; updateUI(); } } throwGrenade(tx, ty) { if (this.grenades > 0 && this.grenadeCooldown <= 0) { this.grenades--; this.grenadeCooldown=60; thrownGrenades.push(new GrenadeObj(this.x, this.y, tx, ty)); updateUI(); } } shootInput(angle) { if (this.cooldown > 0) return; this.muzzleTimer=3; if (this.weapon==='shotgun'||this.weapon==='sniper') screenShake=5; if (this.weapon==='pistol') this.spawnBullet(angle, 0, 20, 20); else if (this.weapon==='rifle') this.spawnBullet(angle, (Math.random()-0.5)*0.2, 10, 6); else if (this.weapon==='shotgun') { this.spawnBullet(angle,0,15,45); this.spawnBullet(angle+0.15,0,15,45); this.spawnBullet(angle-0.15,0,15,45); } else if (this.weapon==='sniper') this.spawnBullet(angle, 0, 100, 60, 25); else if (this.weapon==='minigun') { this.spawnBullet(angle, (Math.random()-0.5)*0.4, 8, 3); screenShake=2; } else if (this.weapon==='snowball') this.spawnBullet(angle, 0, 10000, 30, 10, 'snowball'); } spawnBullet(angle, spread, dmg, cd, speed=BULLET_SPEED, type='normal') { const finalAngle = angle+spread; const vel = {x:Math.cos(finalAngle)*speed, y:Math.sin(finalAngle)*speed}; let r=4; if(typeof type!=='string') r=type; bullets.push(new Bullet(this.x, this.y, vel, false, dmg, r, typeof type==='string'?type:null)); this.cooldown=cd; } }
        class Enemy extends Entity { constructor(x, y, type) { let r=15, hp=40, c='#FF3333', s=ENEMY_SPEED; if(type==='boss') { r=40; hp=600; c='#A020F0'; s=1.2; } if(currentMissionId===6) s*=1.4; if(currentMissionId===8) s*=1.2; super(x, y, r, c, hp); this.type=type; this.speed=s; } draw() { let a=0; if(player&&!player.dead) a=Math.atan2(player.y-this.y, player.x-this.x); ctx.save(); ctx.translate(this.x, this.y); ctx.rotate(a); let ox=this.x; let oy=this.y; this.x=0; this.y=0; super.drawBase(); this.x=ox; this.y=oy; ctx.fillStyle=this.type==='boss'?'#4A004A':'#550000'; ctx.fillRect(this.radius-2, -(this.type==='boss'?5:3), this.type==='boss'?25:15, this.type==='boss'?10:6); ctx.restore(); this.drawHealthBar(); } update() { if (this.cooldown>0) this.cooldown--; const dist=Math.hypot(player.x-this.x, player.y-this.y); const angle=Math.atan2(player.y-this.y, player.x-this.x); if (currentMissionId===11) { if (dist>500) this.move(Math.cos(angle)*0.5, Math.sin(angle)*0.5); } else { if (dist > 150+this.radius) this.move(Math.cos(angle)*this.speed, Math.sin(angle)*this.speed); else if (dist < 100) this.move(-Math.cos(angle)*this.speed*0.5, -Math.sin(angle)*this.speed*0.5); } let shootDist = this.type==='boss'?600:400; let chance = this.type==='boss'?0.1:0.03; if(currentMissionId===11) chance=0.08; if (dist<shootDist && Math.random()<chance) { const shotA = angle + (Math.random()-0.5)*(currentMissionId===11?0.05:0.3); let dmg=10, bSpeed=BULLET_SPEED, bRad=4; if(this.type==='boss'){dmg=25;bRad=8;} if(currentMissionId===11){dmg=30;bSpeed=20;} bullets.push(new Bullet(this.x, this.y, {x:Math.cos(shotA)*bSpeed, y:Math.sin(shotA)*bSpeed}, true, dmg, bRad)); this.cooldown=40; } } takeDamage(amount) { this.hp-=amount; if(this.hp<=0 && !this.dead) { this.dead=true; createParticles(this.x, this.y, this.color); playerStats.totalKills++; addPlayerXp(this.type==='boss'?100:10); let r=Math.random(); let gC=(currentMissionId===8||currentMissionId===7)?0.4:0.15; if(r<0.3) drops.push(new DropItem(this.x+10, this.y, 'coin')); if(r<gC) drops.push(new DropItem(this.x, this.y, 'grenade')); else if(r<gC+0.3) drops.push(new DropItem(this.x, this.y, 'medkit')); } } }
        class Bullet { constructor(x, y, vel, isEnemy, dmg, radius=4, specialType=null) { this.x=x; this.y=y; this.vel=vel; this.isEnemy=isEnemy; this.dmg=dmg; this.radius=radius; this.specialType=specialType; if(specialType==='snowball') this.radius=8; this.dead=false; } update() { this.x+=this.vel.x; this.y+=this.vel.y; if (!(activeCheats.wallbang && !this.isEnemy)) { for(let obs of obstacles) if(this.x>obs.x && this.x<obs.x+obs.size && this.y>obs.y && this.y<obs.y+obs.size) { this.dead=true; if(this.specialType==='snowball') this.explode(); else createParticles(this.x,this.y,'#888'); return; } } if(this.x<0||this.x>canvas.width||this.y<0||this.y>canvas.height) this.dead=true; } draw() { ctx.beginPath(); ctx.arc(this.x, this.y, this.radius, 0, Math.PI*2); if(this.specialType==='snowball') { ctx.fillStyle='#FFF'; ctx.shadowBlur=10; ctx.shadowColor='white'; } else { ctx.fillStyle=this.isEnemy?(this.radius>4?'#A020F0':'orange'):'#FFFF00'; ctx.shadowBlur=0; } ctx.fill(); ctx.shadowBlur=0; } explode() { createExplosion(this.x, this.y); enemies.forEach(en => { if(Math.hypot(en.x-this.x, en.y-this.y)<100) en.takeDamage(10000); }); } }
        function createParticles(x, y, c) { for(let i=0; i<5; i++) particles.push({x,y,color:c, vx:(Math.random()-0.5)*7, vy:(Math.random()-0.5)*7, life:15}); }
        function createExplosion(x, y) { for(let i=0; i<30; i++) particles.push({x,y,color:i%2===0?'orange':'red', vx:(Math.random()-0.5)*15, vy:(Math.random()-0.5)*15, life:30}); particles.push({x,y,color:'rgba(255,255,255,0.8)', vx:0, vy:0, life:15, radius:100, isShockwave:true}); }

        const wpnNames = {'pistol':'–ü—ñ—Å—Ç–æ–ª–µ—Ç', 'rifle':'–ê–≤—Ç–æ–º–∞—Ç', 'shotgun':'–î—Ä–æ–±–æ–≤–∏–∫', 'sniper':'–°–Ω–∞–π–ø–µ—Ä', 'minigun':'–ö—É–ª–µ–º–µ—Ç', 'snowball':'–°–Ω—ñ–≥–æ–º–µ—Ç'};
        const wpnKeys = ['pistol', 'rifle', 'shotgun', 'sniper', 'minigun', 'snowball'];
        function updateUI() { if(player) { if(controlMode==='PC') document.getElementById('weapon-info').innerText=wpnNames[player.weapon]; document.getElementById('grenade-counter').innerText="üí£:"+player.grenades; document.getElementById('coin-counter').innerText="üí∞:"+playerStats.coins; let xpPerc = (playerStats.xp/playerStats.nextLevelXp)*100; document.getElementById('xp-fill').style.width=xpPerc+'%'; document.getElementById('level-text').innerText="LVL "+playerStats.level; if(controlMode==='MOBILE') { document.querySelectorAll('.wpn-btn').forEach(btn => { let w = btn.getAttribute('data-wpn'); let active = player.weapon === w; let locked = !playerStats.unlockedWeapons.includes(w) || (w==='minigun' && playerStats.level < 5); btn.className = 'wpn-btn' + (active?' active':'') + (locked?' locked':''); }); } } }
        function setupMobileWeapons() { const bar = document.getElementById('weapon-bar'); bar.innerHTML=''; wpnKeys.forEach(k => { if(k==='snowball' && !playerStats.unlockedWeapons.includes(k)) return; let d=document.createElement('div'); d.className='wpn-btn'; d.setAttribute('data-wpn', k); d.innerText = k.substr(0,4).toUpperCase(); d.onclick = function() { if(player) player.trySetWeapon(k); }; bar.appendChild(d); }); }
        function throwGrenadeMobile() { if(player) { const d=250; player.throwGrenade(player.x+Math.cos(lastAimAngle)*d, player.y+Math.sin(lastAimAngle)*d); } }

        function showMainMenu() { gameState='MENU'; document.getElementById('menu-overlay').style.display='flex'; document.getElementById('end-game-btn').style.display='none'; document.getElementById('game-ui').style.display='none'; document.querySelector('.shop-btn').style.display='block'; document.getElementById('menu-buttons').style.display='grid'; updateMenuStats(); }
        function startMission(id) { currentMissionId=id; gameState='PLAYING'; player = new Player(canvas.width/2, canvas.height/2); enemies=[]; bullets=[]; particles=[]; obstacles=[]; drops=[]; thrownGrenades=[]; decorations=[]; gameTime=0; enemiesKilled=0; grenadesKilled=0; bossSpawned=false; zoneTimer=0; keys={}; mouse.down=false; joystickLeft={x:0,y:0,active:false}; joystickRight={x:0,y:0,active:false}; if(id===9) { captureZone.x=canvas.width/2; captureZone.y=canvas.height/2; } for(let i=0; i<30; i++) decorations.push({x:Math.random()*canvas.width, y:Math.random()*canvas.height, size:Math.random()*20+10}); for (let i=0; i<12; i++) { let s=40+Math.random()*60; let x=50+Math.random()*(canvas.width-s-100); let y=50+Math.random()*(canvas.height-s-100); if(id===9 && Math.hypot(x-canvas.width/2, y-canvas.height/2)<150) continue; if(Math.hypot(x-player.x, y-player.y)>200) obstacles.push(new Rect(x, y, s)); } let t="–ú—ñ—Å—ñ—è"; if(id===1)t="–í–∏–∂–∏—Ç–∏ 20—Å"; if(id===2)t="–í–±–∏—Ç–∏ 5"; if(id===3)t="–í–±–∏—Ç–∏ –ë–û–°–ê"; if(id===4)t="–û–†–î–ê 40—Å"; if(id===5)t="–í–±–∏—Ç–∏ 50"; if(id===6)t="–•–ê–†–î 60—Å"; if(id===7)t="–ü–Ü–î–†–ò–í (15)"; if(id===8)t="–ê–ü–û–ö–ê–õ–Ü–ü–°–ò–°"; if(id===9)t="–ó–ê–•–í–ê–¢"; if(id===10)t="–¢–ï–ú–†–Ø–í–ê"; if(id===11)t="–°–ù–ê–ô–ü–ï–†"; document.getElementById('mission-text').innerText=t; document.getElementById('menu-overlay').style.display='none'; document.getElementById('game-ui').style.display='block'; updateUI(); }
        function gameOver(win) { gameState='GAMEOVER'; saveGame(); document.getElementById('menu-overlay').style.display='flex'; document.getElementById('end-game-btn').style.display='block'; document.getElementById('menu-buttons').style.display='none'; document.querySelector('.shop-btn').style.display='none'; let t=document.getElementById('menu-title'); t.innerText=win?"–ü–ï–†–ï–ú–û–ì–ê":"–ü–û–†–ê–ó–ö–ê"; t.style.color=win?"#00FF00":"red"; }
        function spawnEnemyEdge(forceBoss=false) { let s=Math.floor(Math.random()*4), x, y; if(s===0){x=Math.random()*canvas.width;y=-30;} else if(s===1){x=canvas.width+30;y=Math.random()*canvas.height;} else if(s===2){x=Math.random()*canvas.width;y=canvas.height+30;} else{x=-30;y=Math.random()*canvas.height;} enemies.push(new Enemy(x, y, forceBoss?'boss':'standard')); }

        function updateGame() { if (gameState!=='PLAYING') return; gameTime+=1/60; snowflakes.forEach(f => { f.y+=f.s; if(f.y>canvas.height)f.y=-10; }); if (currentMissionId===3 && !bossSpawned && gameTime>1) { spawnEnemyEdge(true); bossSpawned=true; } let sr=120; if([3,9,10].includes(currentMissionId)) sr=180; if([4,6,8,11].includes(currentMissionId)) sr=60; if (Math.floor(gameTime*60)%sr===0) spawnEnemyEdge(); player.update(); document.getElementById('health-fill').style.width=Math.max(0,player.hp)+'%'; if(currentMissionId===1&&gameTime>=20) gameOver(true); if(currentMissionId===2&&enemiesKilled>=5) gameOver(true); if(currentMissionId===3 && bossSpawned && !enemies.some(e=>e.type==='boss')) gameOver(true); if(currentMissionId===4&&gameTime>=40) gameOver(true); if(currentMissionId===5&&enemiesKilled>=50) gameOver(true); if(currentMissionId===6&&gameTime>=60) gameOver(true); if(currentMissionId===7&&grenadesKilled>=15) gameOver(true); if(currentMissionId===8&&gameTime>=50) gameOver(true); if(currentMissionId===11&&enemiesKilled>=10) gameOver(true); if(currentMissionId===9) { if(Math.hypot(player.x-captureZone.x, player.y-captureZone.y)<captureZone.radius) { zoneTimer+=1/60; if(zoneTimer>=15)gameOver(true); } document.getElementById('stats').innerText=`Zone: ${zoneTimer.toFixed(1)}/15`; } else if(currentMissionId===7) document.getElementById('stats').innerText=`Bomb: ${grenadesKilled}/15`; else document.getElementById('stats').innerText=`Time: ${gameTime.toFixed(0)}`; drops.forEach((m,i)=>{ if(Math.hypot(m.x-player.x, m.y-player.y)<player.radius+m.size) { if(m.type==='medkit'){player.hp=Math.min(player.maxHp, player.hp+25); createParticles(player.x,player.y,'#00FF00');} else if(m.type==='grenade'){player.grenades++; updateUI(); createParticles(player.x,player.y,'#FFA500');} else if(m.type==='coin'){playerStats.coins+=10; updateUI(); createParticles(player.x,player.y,'#FFFF00');} drops.splice(i,1); } }); enemies.forEach((e,i)=>{ e.update(); if(e.dead)enemies.splice(i,1); }); thrownGrenades.forEach((g,i)=>{ g.update(); if(g.dead)thrownGrenades.splice(i,1); }); bullets.forEach((b,i)=>{ b.update(); let hit=false; if(!b.isEnemy) { enemies.forEach(en=>{ if(!hit && Math.hypot(b.x-en.x, b.y-en.y)<en.radius+b.radius) { en.takeDamage(b.dmg); hit=true; if(b.specialType==='snowball'){b.explode();b.dead=true;} else createParticles(b.x,b.y,'red'); } }); } else { if(Math.hypot(b.x-player.x, b.y-player.y)<player.radius+b.radius) { player.hp-=b.dmg; hit=true; createParticles(b.x,b.y,'blue'); screenShake=5; if(player.hp<=0)gameOver(false); } } if(hit||b.dead) bullets.splice(i,1); }); particles.forEach((p,i)=>{ if(p.isShockwave){p.radius+=5;p.life--;}else{p.x+=p.vx;p.y+=p.vy;p.life--;} if(p.life<=0)particles.splice(i,1); }); if(screenShake>0) screenShake*=0.9; }
        function drawGame() { ctx.save(); if(screenShake>0.5) ctx.translate((Math.random()-0.5)*screenShake, (Math.random()-0.5)*screenShake); ctx.fillStyle='#1a1a2e'; ctx.fillRect(0,0,canvas.width, canvas.height); ctx.fillStyle='rgba(240,240,255,0.1)'; decorations.forEach(d=>{ctx.beginPath();ctx.arc(d.x,d.y,d.size,0,Math.PI*2);ctx.fill();}); if(currentMissionId===9) { ctx.beginPath(); ctx.arc(captureZone.x, captureZone.y, captureZone.radius, 0, Math.PI*2); ctx.fillStyle='rgba(0,100,255,0.3)'; ctx.fill(); ctx.strokeStyle='#0077FF'; ctx.lineWidth=2; ctx.stroke(); } obstacles.forEach(o=>o.draw()); drops.forEach(m=>m.draw()); thrownGrenades.forEach(g=>g.draw()); particles.forEach(p=>{ if(p.isShockwave){ctx.beginPath();ctx.arc(p.x,p.y,p.radius,0,Math.PI*2);ctx.fillStyle=`rgba(255,255,255,${p.life/20})`;ctx.fill();} else{ctx.fillStyle=p.color;ctx.fillRect(p.x,p.y,3,3);} }); bullets.forEach(b=>b.draw()); enemies.forEach(e=>e.draw()); if(activeCheats.wh) enemies.forEach(e=>{ ctx.save(); ctx.beginPath(); ctx.moveTo(player.x, player.y); ctx.lineTo(e.x, e.y); ctx.strokeStyle='rgba(255,0,0,0.5)'; ctx.stroke(); ctx.beginPath(); ctx.rect(e.x-e.radius-5, e.y-e.radius-5, e.radius*2+10, e.radius*2+10); ctx.strokeStyle='red'; ctx.stroke(); ctx.restore(); }); if(player.hp>0) player.draw(); ctx.fillStyle='rgba(255,255,255,0.6)'; snowflakes.forEach(f=>{ctx.beginPath();ctx.arc(f.x,f.y,f.r,0,Math.PI*2);ctx.fill();}); if(currentMissionId===10) { ctx.setTransform(1,0,0,1,0,0); let g=ctx.createRadialGradient(player.x, player.y, 50, player.x, player.y, 250); g.addColorStop(0,'rgba(0,0,0,0)'); g.addColorStop(1,'rgba(0,0,0,0.98)'); ctx.fillStyle=g; ctx.fillRect(0,0,canvas.width, canvas.height); } ctx.restore(); }
        function loop() { requestAnimationFrame(loop); if(gameState==='PLAYING'){updateGame(); drawGame();} }
        window.addEventListener('keydown', e=>{if(controlMode==='PC')keys[e.code]=true;}); window.addEventListener('keyup', e=>{if(controlMode==='PC')keys[e.code]=false;}); window.addEventListener('mousemove', e=>{if(controlMode==='PC'){mouse.x=e.clientX; mouse.y=e.clientY;}}); window.addEventListener('mousedown', ()=>{if(controlMode==='PC')mouse.down=true;}); window.addEventListener('mouseup', ()=>{if(controlMode==='PC')mouse.down=false;});
        function handleJoystick(t, isLeft) { const z=isLeft?document.getElementById('stick-left'):document.getElementById('stick-right'); const r=z.getBoundingClientRect(); let dx=t.clientX-(r.left+r.width/2), dy=t.clientY-(r.top+r.height/2); const md=r.width/2, d=Math.min(Math.hypot(dx,dy), md), a=Math.atan2(dy,dx); const knob=isLeft?document.getElementById('knob-left'):document.getElementById('knob-right'); knob.style.transform=`translate(-50%,-50%) translate(${Math.cos(a)*d}px, ${Math.sin(a)*d}px)`; if(isLeft){joystickLeft.x=Math.cos(a)*(d/md); joystickLeft.y=Math.sin(a)*(d/md); joystickLeft.active=true; joystickLeft.id=t.identifier;} else{joystickRight.x=Math.cos(a)*(d/md); joystickRight.y=Math.sin(a)*(d/md); joystickRight.active=true; joystickRight.id=t.identifier;} }
        function resetJoystick(isLeft) { if(isLeft){joystickLeft.active=false;joystickLeft.x=0;joystickLeft.y=0;document.getElementById('knob-left').style.transform='translate(-50%,-50%)';} else{joystickRight.active=false;joystickRight.x=0;joystickRight.y=0;document.getElementById('knob-right').style.transform='translate(-50%,-50%)';} }
        document.addEventListener('touchstart', e=>{ if(controlMode!=='MOBILE'||gameState!=='PLAYING')return; for(let i=0;i<e.changedTouches.length;i++){ let t=e.changedTouches[i]; if(t.target.id==='mobile-grenade-btn'||t.target.classList.contains('wpn-btn'))continue; let zl=document.getElementById('stick-left').getBoundingClientRect(); if(t.clientX>=zl.left&&t.clientX<=zl.right&&t.clientY>=zl.top&&t.clientY<=zl.bottom) handleJoystick(t,true); let zr=document.getElementById('stick-right').getBoundingClientRect(); if(t.clientX>=zr.left&&t.clientX<=zr.right&&t.clientY>=zr.top&&t.clientY<=zr.bottom) handleJoystick(t,false); } },{passive:false});
        document.addEventListener('touchmove', e=>{ if(controlMode!=='MOBILE'||gameState!=='PLAYING')return; e.preventDefault(); for(let i=0;i<e.changedTouches.length;i++){ let t=e.changedTouches[i]; if(t.identifier===joystickLeft.id)handleJoystick(t,true); if(t.identifier===joystickRight.id)handleJoystick(t,false); } },{passive:false});
        document.addEventListener('touchend', e=>{ if(controlMode!=='MOBILE')return; for(let i=0;i<e.changedTouches.length;i++){ let t=e.changedTouches[i]; if(t.identifier===joystickLeft.id)resetJoystick(true); if(t.identifier===joystickRight.id)resetJoystick(false); } });
        loop();
    </script>
</body>
</html>
